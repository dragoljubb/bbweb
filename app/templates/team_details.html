{% extends "layout.html" %}

{% block content %}

<!-- Top header panel -->

<div class="team-header d-flex align-items-center mb-4">

  <div class="team-details-info">{{team.club_info}}  </div>


  <!-- Watermark grb -->
  <img src="{{team_logo(team.club_code) }}"
       alt="{{ team.club_name }}"
       class="team-header-logo">

  <!-- Info desno -->
  <div class="team-header-info ms-auto text-end">
  <div class="team-meta">
    <div class="meta-item"><span class="meta-label">Country:</span> {{ team.country_name }}</div>
    <div class="meta-item"><span class="meta-label">City:</span> {{ team.city }}</div>
    <div class="meta-item"><span class="meta-label">Arena:</span> {{ team.arena_name }}</div>
    <div class="meta-item"><span class="meta-label">President:</span> {{ team.president }}</div>
    <div class="meta-item"><span class="meta-label">Phone:</span> {{ team.phone }}</div>
  </div>
</div>

</div>

 <h2 class="team-name">{{ team.club_name }}</h2>

<ul class="nav nav-tabs mb-3" id="teamTabs" role="tablist">
  <li class="nav-item" role="presentation">
    <button class="nav-link active" id="roster-tab" data-bs-toggle="tab" data-bs-target="#roster" type="button" role="tab">Roster</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="games-tab" data-bs-toggle="tab" data-bs-target="#games" type="button" role="tab">Games</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="stats-tab" data-bs-toggle="tab" data-bs-target="#stats" type="button" role="tab">Stats</button>
  </li>
</ul>

<div class="tab-content" id="teamTabsContent">

  <!-- Roster -->
<div class="tab-pane fade show active" id="roster" role="tabpanel">

  {% for pos in position_order %}
    {% if grouped_roster[pos] %}

      <h5 class="position-title">{{ pos }}</h5>

      <div class="persons-grid">
        {% for player in grouped_roster[pos] %}
        <a href="{{ url_for('person_profile', person_code=player.person_code) }}" class="player-card-link">
          <div class="person-card">
            <div class="person-img">
              <img src="{{ person_img(player.club_code, player.person_code) }}"
                   alt="{{ player.formatted_name }}">
            </div>

            <div class="person-name">
              <div class="first-name">{{ player.first_name }}</div>
              <div class="last-name">{{ player.last_name }}</div>
            </div>

            <div class="player-number">
              <span class="jersey-prefix">#</span>{{ player.dorsal }}
            </div>
          </div>
        </a>
        {% endfor %}
      </div>

    {% endif %}
  {% endfor %}
   {% if coaches %}
   <h5 class="position-title">Coaches</h5>

    <div class="persons-grid">
      {% for coach in coaches %}
        <a href="{{ url_for('person_profile', person_code=coach.person_code) }}"
           class="person-card coach">

          <div class="person-img">
            <img src="{{ person_img(coach.club_code, coach.person_code) }}"
                 alt="{{ coach.formatted_name }}">
          </div>

          <div class="person-name">
            <div class="coach-title">{{ coach.person_type_name }}</div>
            <div class="first-name">{{ coach.first_name }}</div>
            <div class="last-name">{{ coach.last_name }}</div>
          </div>

        </a>
      {% endfor %}
    </div>
  {% endif %}

</div>


  <!-- Games -->
  <div class="tab-pane fade" id="games" role="tabpanel">

    <!-- Seasons filter -->
    <div class="games-filters mb-3">
      <select id="seasonSelectGames" class="form-select w-auto">
        {% for s in seasons %}
          <option value="{{ s.code }}"
            {% if s.code == selected_season %}selected{% endif %}>
            {{ s.label }}
          </option>
        {% endfor %}
      </select>
    </div>

        {% if next_game %}
          <h5 class="mt-3">Next Game</h5>
          <div class="next-game">
            {% set g = next_game %}
            {% include "components/game_card_full.html" %}
          </div>
        {% endif %}

        {% if results %}
        <h5 class="mt-4">Results</h5>
        <div class="results-games">
          {% for g in results %}
            {% include "components/game_card_full.html" %}
          {% endfor %}
        </div>
        {% endif %}

        {% if upcoming %}
        <h5 class="mt-4">Upcoming Games</h5>
        <div class="upcoming-games">
          {% for g in upcoming %}
            {% include "components/game_card_full.html" %}
          {% endfor %}
        </div>
        {% endif %}

  </div>

   <!-- STATS -->
    <div class="tab-pane fade" id="stats" role="tabpanel">

  <div class="row g-3 mb-4">

    <div class="col-md-2">
      <div class="stat-card">
  <div class="stat-label">Points</div>

  <div class="stat-body">
    <div class="stat-row">
      <span class="stat-prefix">TOT</span>
      <span class="stat-value">{{ team_stats.acc_points }}</span>
    </div>

    <div class="stat-row">
      <span class="stat-prefix">AVG</span>
      <span class="stat-value">{{ "%.1f"|format(team_stats.avg_points) }}</span>
    </div>
  </div>
</div>

    </div>

    <div class="col-md-2">
       <div class="stat-card">
  <div class="stat-label">Rebounds</div>

  <div class="stat-body">
    <div class="stat-row">
      <span class="stat-prefix">TOT</span>
      <span class="stat-value">{{ team_stats.acc_total_rebounds }}</span>
    </div>

    <div class="stat-row">
      <span class="stat-prefix">AVG</span>
       <span class="stat-value">{{ "%.1f"|format(team_stats.avg_total_rebounds) }}</span>
    </div>
  </div>
</div>
    </div>

    <div class="col-md-2">  <div class="stat-card">
  <div class="stat-label">Asissts</div>

  <div class="stat-body">
    <div class="stat-row">
      <span class="stat-prefix">TOT</span>
      <span class="stat-value">{{ team_stats.acc_assistances }}</span>
    </div>

    <div class="stat-row">
      <span class="stat-prefix">AVG</span>
       <span class="stat-value">{{ "%.1f"|format(team_stats.avg_assistances) }}</span>
    </div>
  </div>
</div>
    </div>

    <div class="col-md-2">
        <div class="stat-card">
  <div class="stat-label">Steals</div>

  <div class="stat-body">
    <div class="stat-row">
      <span class="stat-prefix">TOT</span>
      <span class="stat-value">{{ team_stats.acc_steals }}</span>
    </div>

    <div class="stat-row">
      <span class="stat-prefix">AVG</span>
          <span class="stat-value">{{ "%.1f"|format(team_stats.avg_steals) }}</span>
    </div>
  </div>
</div>
    </div>

    <div class="col-md-2">
      <div class="stat-card">
      <div class="stat-label">Blocks</div>

      <div class="stat-body">
      <div class="stat-row">
       <span class="stat-prefix">TOT</span>
       <span class="stat-value">{{ team_stats.acc_blocks_favour }}</span>

      </div>

      <div class="stat-row">
        <span class="stat-prefix">AVG</span>
         <span class="stat-value">{{ "%.1f"|format(team_stats.avg_blocks_favour) }}</span>
      </div>
    </div>
    </div>
     </div>

    <div class="col-md-2">
      <div class="stat-card stat-highlight">
       <div class="stat-label">PIR</div>

      <div class="stat-body">
      <div class="stat-row">
       <span class="stat-prefix">TOT</span>
       <span class="stat-value">{{ team_stats.acc_valuation }}</span>
      </div>

      <div class="stat-row">
        <span class="stat-prefix">AVG</span>
         <span class="stat-value">{{ "%.1f"|format(team_stats.avg_valuation) }}</span>
      </div>
    </div>
      </div>
    </div>

  </div>


      <div class="table-responsive mt-4">
  <table class="table table-hover align-middle player-stats-table">
   <thead>
  <tr>
    <!-- bez grupisanja -->
   <th class="group-start">#</th>
    <th class="group-start">Player</th>
    <th class="group-start">Played</th>

    <!-- TIME (grupa od 2) -->
    <th colspan="2" class="group-start">Time</th>

    <!-- POINTS -->
    <th colspan="2" class="group-start">Points</th>

    <!-- REBOUNDS -->
    <th colspan="2" class="group-start">Rebounds</th>

    <!-- ASSISTS -->
    <th colspan="2" class="group-start">ASSISTS</th>

    <!-- STEALS -->
    <th colspan="2" class="group-start">STEALS</th>

    <!-- BLOCKS -->
    <th colspan="2" class="group-start">BLOCKS</th>

    <!-- FG2 -->
    <th colspan="2" class="group-start">FG2</th>

    <!-- FG3 -->
    <th colspan="2" class="group-start">FG3</th>

    <!-- FT -->
    <th colspan="2" class="group-start">FT</th>

    <!-- PIR -->
    <th colspan="2" class="group-start">PIR</th>
  </tr>

  <tr>

     <th class="group-start"></th>
    <th class="group-start"></th>
    <th class="group-start"></th>

    <!-- TIME -->
    <th class="group-start">T</th>
    <th>A</th>

    <!-- POINTS -->
    <th class="group-start">T</th>
    <th>A</th>

    <!-- RB -->
    <th class="group-start">T</th>
    <th>A</th>

    <!-- AS -->
    <th class="group-start">T</th>
    <th>A</th>

    <!-- ST -->
    <th class="group-start">T</th>
    <th>A</th>

    <!-- BL -->
    <th class="group-start">T</th>
    <th>A</th>

    <!-- FG2 -->
    <th class="group-start">M/A</th>
    <th>%</th>

    <!-- FG3 -->
    <th class="group-start">M/A</th>
    <th>%</th>

    <!-- FT -->
    <th class="group-start">M/A</th>
    <th>%</th>

    <!-- PIR -->
    <th class="group-start">TOT</th>
    <th>AVG</th>
  </tr>
</thead>

    <tbody>
      {% for p in players_stats %}
      <tr>

        <td>{{ p.dorsal }}</td>
        <td>{{ p.person_name }}</td>
        <td>{{ p.acc_games_played }}</td>
        <td>{{ (p.acc_time_played_sec // 60) }}:{{ '%02d' % (p.acc_time_played_sec % 60) }}</td>
         <td>{{ (p.avg_time_played_sec // 60) }}:{{ '%02d' % (p.avg_time_played_sec % 60) }}</td>
        <td>{{ p.acc_points }}</td>
        <td>{{ "%.1f"|format(p.avg_points ) }}</td>
        <td>{{ p.acc_rebounds_total }}</td>
        <td>{{ "%.1f"|format(p.avg_rebounds_total ) }}</td>
        <td>{{ p.acc_assists }}</td>
        <td>{{ "%.1f"|format(p.avg_assists) }}</td>
        <td>{{ p.acc_steals }}</td>
        <td>{{ "%.1f"|format(p.avg_steals) }}</td>
        <td>{{ p.acc_blocks_favour }}</td>
        <td>{{ "%.1f"|format(p.avg_blocks_favour) }}</td>
        <td>{{ p.acc_fg2_made }}/{{ p.acc_fg2_attempted }}</td>
        <td>{{ "%.1f"|format(p.acc_fg2_num * 100) }}%</td>
        <td>{{ p.acc_fg3_made }}/{{ p.acc_fg3_attempted }}</td>
        <td>{{ "%.1f"|format(p.acc_fg3_num * 100) }}%</td>
        <td>{{ p.acc_ft_made }}/{{ p.acc_ft_attempted }}</td>
        <td>{{ "%.1f"|format(p.acc_ft_num * 100) }}%</td>
        <td>{{ p.acc_valuation }}</td>
        <td>{{ "%.1f"|format(p.avg_valuation) }}</td>
      </tr>
      {% endfor %}

     <!-- TEAM TOTAL -->
  <tr>
    <td></td>
    <td>TOTALS</td>
    <td>{{ team_stats.acc_games_played }}</td>
    <td>{{ (5*team_stats.acc_time_played // 60) }}:{{ '%02d' % (team_stats.acc_time_played % 60) }}</td>
    <td>{{ (5*team_stats.avg_time_played // 60) }}:{{ '%02d' % (team_stats.avg_time_played % 60) }}</td>
    <td>{{ team_stats.acc_points }}</td>
    <td>{{ "%.1f"|format(team_stats.avg_points) }}</td>
    <td>{{ team_stats.acc_total_rebounds }}</td>
    <td>{{ "%.1f"|format(team_stats.avg_total_rebounds)}}</td>
    <td>{{ team_stats.acc_assistances  }}</td>
     <td>{{ "%.1f"|format(team_stats.avg_assistances)}}</td>
    <td>{{ team_stats.acc_steals }}</td>
    <td>{{ "%.1f"|format(team_stats.avg_steals)}}</td>
    <td>{{ team_stats.acc_blocks_favour }}</td>
     <td>{{ "%.1f"|format(team_stats.avg_blocks_favour)}}</td>
    <td>{{ team_stats.acc_fg2_txt }}</td>
    <td>{{ "%.1f"|format(team_stats.acc_fg2_num * 100) }}%</td>
    <td>{{ team_stats.acc_fg3_txt}}</td>
    <td>{{ "%.1f"|format(team_stats.acc_fg3_num * 100) }}%</td>
    <td>{{ team_stats.acc_ft_txt }}</td>
    <td>{{ "%.1f"|format(team_stats.acc_ft_num * 100) }}%</td>
    <td>{{ team_stats.acc_valuation }}</td>
    <td>{{ "%.1f"|format(team_stats.avg_valuation)}}</td>
  </tr>




    </tbody>
  </table>
</div>


   </div>

</div>





<!-- CSS -->
<style>
/* ===============================
   TEAM HEADER
   =============================== */
.team-header {
  position: relative;
  display: flex;
  align-items: center;
  height: 210px;
  padding: 10px 10px;
  background: #f4f5f7; /* svetla, neutralna pozadina */
  border-radius: 10px;
  overflow: hidden;
}

/* Large transparent logo - centered, samo opacity */
.team-header-logo {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%); /* centriranje horizontalno i vertikalno */
  height: 180px;                     /* prilagodjeno */
  width: auto;
  opacity: 0.1;                       /* diskretno */
  pointer-events: none;
  z-index: 1;
}

/* Right aligned info */
.team-header-info {
  margin-left: auto;
  text-align: right;
  z-index: 2;
  max-width: 60%;
}

/* Team name */
.team-name{
  font-size: 1.8rem;
  font-weight: 700;
  letter-spacing: 0.5px;
  margin-bottom: 8px;
  text-align: center;
  padding-top: 5px;

}

/* Meta info text */
.team-header-info p {
  font-size: 0.75rem;
  margin-bottom: 2px;
  color: #555;
  line-height: 1.3;
}

/* Back button */
.team-header .btn {
  position: absolute;
  top: 16px;
  right: 20px;
  z-index: 3;
}

/* ===============================
   TABS
   =============================== */
.nav-tabs .nav-link {
  font-size: 0.85rem;
  padding: 6px 12px;
}

.nav-tabs .nav-link.active {
  font-weight: 600;
}

/* ===============================
   ROSTER
   =============================== */
.tab-pane img {
  height: 90px;
  width: 100%;
  object-fit: cover;
  border-radius: 4px;
}

.tab-pane p {
  font-size: 0.8rem;
  margin-bottom: 2px;
}

.tab-pane small {
  font-size: 0.7rem;
  color: #777;
}

/* ===============================
   GAMES TABLE
   =============================== */
.table th, .table td {
  vertical-align: middle;
  font-size: 0.8rem;
}

/* ===============================
   UTILITIES
   =============================== */
.text-muted-small {
  font-size: 0.75rem;
  color: #666;
}


.team-details-info
{
  font-size: 0.58rem;
  color: #555;
  max-width: 35%;
  padding-top: 25px;
}

.team-meta {
  display: flex;
  flex-direction: column; /* vertikalno */
  gap: 4px;               /* razmak između redova */
  text-align: left;
}

.team-meta .meta-item {
  display: flex;
  align-items: center;
}

.team-meta .meta-label {
  font-weight: 600;       /* bold labela */
  width: 80px;            /* fiksna širina labela za poravnanje */
  margin-right: 8px;      /* razmak između labela i vrednosti */
  text-align: left;      /* labela desno, vrednost levo */
  color: #333;
}

.team-meta .meta-item span {
  /* vrednost */
  color: #555;
}


.games-filters {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 12px;
}

.next-game, .results-games, .upcoming-games {
  display: flex;
  flex-direction: column;
  gap: 10px; /* razmak između panela */
}

/* Opcionalno: Next game panel može biti malo naglašen */
.next-game .game-card-full {
  border-color: #3b82f6; /* plava border za isticanje */
  box-shadow: 0 4px 12px rgba(59,130,246,0.2);
}



.person-card {
  width: 322px;
  height: 76px;
  background: #fff;
  border: 1px solid #e6e6e6;     /* blagi okvir */
  border-radius: 6px;           /* blago zaobljenje */
  display: flex;
  align-items: center;
  transition: box-shadow 0.15s ease, border-color 0.15s ease;
}

.person-card:hover {
  border-color: #cfcfcf;
  box-shadow: 0 2px 6px rgba(0,0,0,0.06);
}


/* LEVA STRANA – SLIKA */
.player-img {
  width: 95px;
  height: 75px;
  overflow: hidden;           /* crop */
  display: flex;
  align-items: flex-start;    /* fokus na vrh */
  justify-content: center;
}

.player-img img {
  width: 95px;                /* PRVO skaliranje po širini */
  height: auto;
  object-fit: cover;
}


.person-img {
  width: 95px;
  height: 75px;
  overflow: hidden;           /* crop */
  display: flex;
  align-items: flex-start;    /* fokus na vrh */
  justify-content: center;
}

.person-img img {
  width: 95px;                /* PRVO skaliranje po širini */
  height: auto;
  object-fit: cover;
}

/* SREDINA – IME / PREZIME */
.person-name {
  width: 140px;
  padding-left: 10px;
  line-height: 1.2;
}

.person-name .first-name {
  font-size: 14px;
}

.person-name .coach-title {
  font-size: 12px;
  font-weight: 600;
  padding-bottom: 6px;
}

.person-name .last-name {
  font-size: 14px;
  font-weight: 700;
}


.person-card.coach .person-name .last-name {
  font-weight: 400;
}

/* DESNO – BROJ DRESA */
.player-number {
  width: 42px;
  height: 38px;
  margin-left: auto;
  margin-right: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 22px;
  font-weight: 700;
}

.player-number .jersey-prefix {
  color: #c7c7c7;            /* vrlo blaga siva */
  font-weight: 400;          /* ne bold */
  margin-right: 2px;
  font-size: 0.9em
}

.position-title {
  margin: 32px 0 16px 0;
  padding-left: 4px;
  font-weight: 600;
  letter-spacing: 0.5px;
}

.persons-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr); /* 4 u redu */
  gap: 16px 20px;
  margin-bottom: 12px;
}

.persons-card-link {
  text-decoration: none;
  color: inherit;
  display: inline-block;
}

.persons-card-link:hover .persons-card {
  border-color: #cfcfcf;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  cursor: pointer;
}

.person-card.coach {
  height: 100px;   /* npr malo viša */
}


.stat-card {
  height: 160px;            /* ili 200px */
  background: #fff;
  border: 1px solid #e5e7eb;
  border-radius: 10px;
  display: flex;
  flex-direction: column;
  text-align: center;        /* centriranje label i ostalog horiz */
}

stat-label {
  font-size: 0.75rem;
  color: #6b7280;
  text-transform: uppercase;
  letter-spacing: 0.5px;

  display: flex;
  align-items: center;
  justify-content: center;

  margin-top: 20px;      /* spušta POINTS */
  margin-bottom: 4px;    /* smanjuje razmak do TOT+AVG */
  height: auto;
}

.stat-body {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: flex-start;  /* sada TOT+AVG idu malo više */
  gap: 4px;                     /* razmak između TOT i AVG */
  margin-top: 20px;             /* dodatno “dizanje” TOT+AVG */
}



.stat-row {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  height: 32px;
}

.stat-prefix {
  position: absolute;
  left: 6px;
  font-size: 0.7rem;
  color: #9ca3af;
  font-weight: 600;
}

.stat-value {
  font-size: 1.6rem;
  font-weight: 700;
  color: #111827;
}


.stat-highlight {
  background: #ddd;
}


.player-stats-table {
  background: #fff;
  border-collapse: separate;
  border-spacing: 0;
  width: 100%;
  font-size: 0.85rem;
}

.player-stats-table thead {
  background-color: #f8f9fa; /* svetlosiva ili može #e7f1ff za diskretno plavo */
  color: #212529;
  font-weight: 600;
}

.player-stats-table th,
.player-stats-table td {
  border-bottom: 1px solid #dee2e6; /* diskretna siva linija */
  text-align: center;
  vertical-align: middle;
  padding: 6px 8px;
}

.player-stats-table tbody tr:hover {
  background-color: #e7f1ff; /* diskretno plavi hover */
}

.player-stats-table td:first-child,
.player-stats-table th:first-child {
  width: 40px; /* broj dresa */
}

.player-stats-table td:nth-child(2),
.player-stats-table th:nth-child(2) {
  text-align: left; /* ime igrača */
  padding-left: 12px;
}.player-stats-table {
  background: #fff;
  border-collapse: separate;
  border-spacing: 0;
  width: 100%;
  font-size: 0.85rem;
}

.player-stats-table thead th {
  font-weight: normal;       /* ne bold */
  color: #6b747c;            /* diskretna siva, bledija */
  background-color: #f8f9fa; /* ili ostavi diskretno plavo #e7f1ff */
  text-align: center;
  vertical-align: middle;
  padding: 6px 8px;
}

.player-stats-table tbody tr:hover {
  background-color: #e7f1ff;
}

.player-stats-table td:first-child,
.player-stats-table th:first-child {
  width: 40px;
}

.player-stats-table td:nth-child(2),
.player-stats-table th:nth-child(2) {
  text-align: left;
  padding-left: 12px;
}


.player-stats-table thead th {
  border-top: none !important;
  border-bottom: none !important;
}

/* BODY – zadržava linije */
.player-stats-table tbody td {
  border-bottom: 1px solid #dee2e6;
}

/* HEADER – bez ikakvih linija */
.player-stats-table thead th {
  border-bottom: none;
  border-top: none;
}

.player-stats-table th.group-start,
.player-stats-table td.group-start {
  border-left: 1px solid rgba(0,0,0,0.05);
}




</style>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  // Sezona dropdown
  const seasonSelect = document.getElementById("seasonSelectGames");
  seasonSelect.addEventListener("change", () => {
    const season = seasonSelect.value;
    const params = new URLSearchParams(window.location.search);
    params.set('season', season);
    window.location.search = params.toString();
  });
});
</script>
{% endblock %}
